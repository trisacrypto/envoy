<div id="preview-envelope-container" class="modal-box mx-auto relative p-4 max-w-5xl">
  <!-- Modal content -->
  <div class="max-h-[450px] overflow-y-auto">
    <!-- Modal header -->
    <div class="md:flex items-center justify-between p-4 border border-black bg-[#D9D9D9]">
      <div class="mb-4 md:mb-0">
        <h1 class="text-xl font-bold text-gray-900 lg:text-2xl">
          Secure Envelope Details: Preview
        </h1>
      </div>
      <form _="on htmx:afterRequest
              if event.detail.successful
                remove @open from #preview_envelope
                then remove .hidden from #success-toast
                then put 'Success! Secure envelope sent.' into #success-toast-msg
                then wait 5s
                then add .hidden to #success-toast
                then reset() the #secure-envelope-form
                then reload() the location of the window
                then go to top of the body" hx-post="/v1/transactions/send-prepared" hx-target="#secure-envelope-form"
        hx-swap="none" hx-ext="json-enc" method="post">
        <input type="hidden" id="travel_address" name="travel_address" value="{{ .Dump }}" />
        <div class="flex flex-row gap-x-2 md:gap-4">
          <button type="submit"
            class="p-1 w-32 rounded bg-green-700 font-semibold text-white md:p-2 hover:bg-green-700/80">Send</button>
          <button type="button" onclick="preview_envelope.close()"
            class="p-1 w-32 rounded bg-[#55ACD8] font-semibold text-white md:p-2 hover:bg-[#55ACD8]/80">Edit</button>
          <button type="button" onclick="preview_envelope.close()"
            class="p-1 w-32 rounded bg-red-700 font-semibold text-white md:p-2 hover:bg-red-700/80">Cancel</button>
        </div>
      </form>
    </div>
    <!-- Modal content -->
    <div class="py-4">
      <section class="mx-auto mb-4 p-4 md:mx-0 lg:mb-0 md:p-6 border border-black rounded bg-[#D9D9D9]">
        <div class="mb-4">
          <h2 class="pb-2 text-lg font-bold">TRANSACTION DETAILS:</h2>
          <dl>
            <div class="grid md:grid-cols-2">
              <div class="transaction-preview-container">
                <dt class="font-semibold">Originator</dt>
                <dd>{{ if .Transaction.Originator }} {{ .Transaction.Originator }} {{ else }} N/A {{ end }}</dd>
              </div>
              <div class="transaction-preview-container">
                <dt class="font-semibold">Beneficiary</dt>
                <dd>{{ if .Transaction.Beneficiary }} {{ .Transaction.Beneficiary }} {{ else }} N/A {{ end }}</dd>
              </div>
            </div>
            <div class="grid md:grid-cols-2">
              <div class="transaction-preview-container">
                <dt class="font-semibold">Amount</dt>
                <dd>{{ if .Transaction.Amount }} {{ .Transaction.Amount }} {{ else }} N/A {{ end }}</dd>
              </div>
              <div class="transaction-preview-container">
                <dt class="font-semibold">Network</dt>
                <dd>{{ if .Transaction.Network }} {{ .Transaction.Network }} {{ else }} N/A {{ end }}</dd>
              </div>
              <div class="transaction-preview-container">
                <dt class="font-semibold">Travel Address</dt>
                <dd class="max-w-sm break-words">
                  {{ if .TravelAddress }} {{ .TravelAddress }} {{ else }} N/A {{ end }}</dd>
              </div>
            </div>
          </dl>
        </div>

        <div class="my-4 grid md:grid-cols-2">
          <div>
            <h2 class="pb-2 text-lg font-bold">ORIGINATOR:</h2>
            {{ $originator := (index .Identity.Originator.OriginatorPersons 0).Person.NaturalPerson }}
            {{ $originatorName := $originator.Name.NameIdentifiers }}
            {{ $originatorAddress := $originator.GeographicAddresses }}

            <dl>
              <div class="transaction-preview-container">
                {{ range $originatorName }}
                <dt class="font-semibold">Name Identifiers</dt>
                <dd>
                  {{ if .SecondaryIdentifier }} {{ .SecondaryIdentifier }} {{ end }}
                  {{ if .PrimaryIdentifier }} {{ .PrimaryIdentifier }} {{ else }} <span>N/A</span>{{ end }}
                </dd>
              </div>
              {{ if or .PrimaryIdentifier .SecondaryIdentifier }}
              <div class="transaction-preview-container">
                <dt class="font-semibold">Name Identifiers Type</dt>
                <dd class="identifier-type badge-style">{{ .NameIdentifierType }}</dd>
              </div>
              {{ end }}
              {{ end }}

              {{ range $originatorAddress }}
              <div class="transaction-preview-container">
                <dt class="font-semibold">Address</dt>
                <div>
                  {{ range .AddressLine }}
                  <dd>{{ . }}</dd>
                  {{ end }}
                  <dd>{{ .Country }}</dd>
                </div>
              </div>
              <div class="transaction-preview-container">
                <dt class="font-semibold">Address Type</dt>
                <dd class="identifier-type badge-style">{{ .AddressType }}</dd>
              </div>
              {{ end }}

              <div class="transaction-preview-container">
                <dt class="font-semibold">Country of Residence</dt>
                <dd>{{ if $originator.CountryOfResidence }} {{ $originator.CountryOfResidence }} {{ else }} N/A {{ end }}</dd>
              </div>
              <div class="transaction-preview-container">
                <dt class="font-semibold">Customer Identification</dt>
                <div>{{ if $originator.CustomerIdentification }} {{ $originator.CustomerIdentification }} {{ else }} N/A {{ end }}</div>
              </div>

              <div class="transaction-preview-container">
                {{ if gt (len .Identity.Originator.AccountNumbers) 1 }}
                <dt class="font-semibold">Account Numbers</dt>
                {{ else }}
                <dt class="font-semibold">Account Number</dt>
                {{ end }}
                {{ range .Identity.Originator.AccountNumbers }}
                <div>{{ if . }} {{ . }} {{ else }} N/A {{ end }}</div>
                {{ end }}
              </div>
            </dl>
          </div>

          <div>
            <h2 class="pb-2 text-lg font-bold">BENEFICIARY:</h2>
            <dl>
              <div class="transaction-preview-container">
                {{ $beneficiary := (index .Identity.Beneficiary.BeneficiaryPersons 0).Person.NaturalPerson }}
                {{ $beneficiaryName := $beneficiary.Name.NameIdentifiers }}

                {{ range $beneficiaryName }}
                <dt class="font-semibold">Name Identifiers</dt>
                <dd>
                  {{ if .SecondaryIdentifier }} {{ .SecondaryIdentifier }} {{ end }} 
                  {{ if .PrimaryIdentifier }} {{ .PrimaryIdentifier }} {{ else }} N/A {{ end }}
                </dd>
              </div>
              {{ if or .PrimaryIdentifier .SecondaryIdentifier }}
              <div class="transaction-preview-container">
                <dt class="font-semibold">Name Identifiers Type</dt>
                <dd class="identifier-type badge-style badge-style">{{ .NameIdentifierType }}</dd>
              </div>
              {{ end }}
              {{ end }}

              {{ $beneficiaryAddress := $beneficiary.GeographicAddresses }}
              <div class="transaction-preview-container">
                <dt class="font-semibold">Address</dt>
                {{ range $beneficiaryAddress }}
                <div>
                  {{ range .AddressLine }}
                  <dd>{{ . }}</dd>
                  {{ end }}
                  <dd>{{ .Country }}</dd>
                </div>
              </div>
              <div class="transaction-preview-container">
                <dt class="font-semibold">Address Type</dt>
                <dd class="identifier-type badge-style">{{ .AddressType }}</dd>
                {{ end }}
              </div>

              <div class="transaction-preview-container">
                <dt class="font-semibold">Country of Residence</dt>
                <dd>{{ if $beneficiary.CountryOfResidence }} {{ $beneficiary.CountryOfResidence }} {{ else }} N/A {{ end }} </dd>
              </div>
              <div class="transaction-preview-container">
                {{ if gt (len .Identity.Beneficiary.AccountNumbers) 1 }}
                <dt class="font-semibold">Account Numbers</dt>
                {{ else }}
                <dt class="font-semibold">Account Number</dt>
                {{ end }}
                {{ range .Identity.Beneficiary.AccountNumbers }}
                <dd>{{ if . }} {{ . }} {{ else }} N/A {{ end }}</dd>
                {{ end }}
              </div>

            </dl>
          </div>
        </div>

        <div class="my-4 grid md:grid-cols-2">
          <div>
            <dl>
              <h2 class="pb-2 text-lg font-bold">ORIGINATING VASP:</h2>
              {{ $originatingVasp := .Identity.OriginatingVasp.OriginatingVasp.Person.LegalPerson }}
              {{ $originatingLegalPerson := $originatingVasp.Name }}

              {{ range $originatingLegalPerson.NameIdentifiers }}
              <div class="transaction-preview-container">
                <dt class="font-semibold">Name Identifiers</dt>
                <dd>{{ if .LegalPersonName }} {{ .LegalPersonName }} {{ else }} N/A {{ end }}</dd>
              </div>
              {{ if .LegalPersonName }}
              <div class="transaction-preview-container">
                <dt class="font-semibold">Name Identifiers Type</dt>
                <dd class="identifier-type badge-style">{{ .LegalPersonNameIdentifierType }}</dd>
              </div>
              {{ end }}
              {{ end }}

              {{ range $originatingLegalPerson.LocalNameIdentifiers }}
              <div class="transaction-preview-container">
                <dt class="font-semibold">Local Name Identifiers</dt>
                <dd>{{ if .LegalPersonName }} {{ .LegalPersonName }} {{ else }} N/A {{ end }}</dd>
              </div>
              {{ if .LegalPersonName }}
              <div class="transaction-preview-container">
                <dt class="font-semibold">Local Name Identifiers Type</dt>
                <dd class="identifier-type badge-style">{{ .LegalPersonNameIdentifierType }}</dd>
              </div>
              {{ end }}
              {{ end }}

              {{ range $originatingLegalPerson.PhoneticNameIdentifiers }}
              <div class="transaction-preview-container">
                <dt class="font-semibold">Phonetic Name Identifiers</dt>
                <dd>{{ if .LegalPersonName }} {{ .LegalPersonName }} {{ else }} N/A {{ end }}</dd>
              </div>
              {{ if .LegalPersonName }}
              <div class="transaction-preview-container">
                <dt class="font-semibold">Phonetic Name Identifiers Type</dt>
                <dd class="identifier-type badge-style">{{ .LegalPersonNameIdentifierType }}</dd>
              </div>
              {{ end }}
              {{ end }}

              <div class="transaction-preview-container">
                {{ range $originatingVasp.GeographicAddresses }}
                <dt class="font-semibold">Address</dt>
                <div>
                  {{ range .AddressLine }}
                  <dd>{{ . }}</dd>
                  {{ end }}
                  <dd>{{ .Country }}</dd>
                </div>
              </div>
              <div>
                <div class="transaction-preview-container">
                  <dt class="font-semibold">Address Type</dt>
                  <dd class="identifier-type badge-style">{{ .AddressType }}</dd>
                </div>
              </div>
              {{ end}}

              {{ $nationalIdentification := $originatingVasp.NationalIdentification }}
              <div class="transaction-preview-container">
                <dt class="font-semibold">National Identification</dt>
                <dd>{{ if $nationalIdentification.NationalIdentifier }} {{ $nationalIdentification.NationalIdentifier }} {{ else }} N/A {{ end }}</dd>
              </div>
              <div class="transaction-preview-container">
                <dt class="font-semibold">National Identification Type</dt>
                <dd class="identifier-type badge-style">{{ $nationalIdentification.NationalIdentifierType }}</dd>
              </div>
              <div class="transaction-preview-container">
                <dt class="font-semibold">Country of Issue</dt>
                <dd>{{ if $nationalIdentification.CountryOfIssue }} {{ $nationalIdentification.CountryOfIssue }} {{ else }} N/A {{ end }}</dd>
              </div>
              <div class="transaction-preview-container">
                <dt class="font-semibold">Registration Authority</dt>
                <dd>{{ if $nationalIdentification.RegistrationAuthority }} {{ $nationalIdentification.RegistrationAuthority }} {{ else }} N/A {{ end }}</dd>
              </div>
              <div class="transaction-preview-container">
                <dt class="font-semibold">Country of Registration</dt>
                <dd>{{ if $originatingVasp.CountryOfRegistration }} {{ $originatingVasp.CountryOfRegistration }} {{ else }} N/A {{ end }}</dd>
              </div>

            </dl>
          </div>

          <div>
            <h2 class="pb-2 text-lg font-bold">BENEFICIARY VASP:</h2>
            {{ $beneficiaryVasp := .Identity.BeneficiaryVasp.BeneficiaryVasp.Person.LegalPerson }}

            <dl>
              {{ range $beneficiaryVasp.Name.NameIdentifiers }}
              <div class="transaction-preview-container">
                <dt class="font-semibold">Name Identifiers</dt>
                <dd>{{ if .LegalPersonName }} {{ .LegalPersonName }} {{ else }} N/A {{ end }}</dd>
              </div>
              {{ if .LegalPersonName }}
              <div class="transaction-preview-container">
                <dt class="font-semibold">Name Identifiers Type</dt>
                <dd class="identifier-type badge-style">{{ .LegalPersonNameIdentifierType }}</dd>
              </div>
              {{ end }}
              {{ end }}

              {{ range $beneficiaryVasp.GeographicAddresses }}
              <div class="transaction-preview-container">
                <dt class="font-semibold">Address</dt>
                <div>
                  <dd>{{ .BuildingNumber }} {{ .StreetName }}</dd>
                  <dd>{{ .PostCode }} {{ .TownName }}</dd>
                  <dd>{{ .Country }}</dd>
                </div>
              </div>
              <!-- TODO: If there isn't an address do not display the type. -->
              <div class="transaction-preview-container">
                <dt class="font-semibold">Address Type</dt>
                <dd class="identifier-type badge-style">{{ .AddressType }}</dd>
                {{ end }}
              </div>

              {{ $beneficiaryNationalIdentifier := $beneficiaryVasp.NationalIdentification }}
              <div class="transaction-preview-container">
                <dt class="font-semibold">National Identification</dt>
                <dd>{{ if $beneficiaryNationalIdentifier.NationalIdentifier }} {{ $beneficiaryNationalIdentifier.NationalIdentifier }} {{ else }} N/A {{ end }}</dd>
              </div>
              <div class="transaction-preview-container">
                <dt class="font-semibold">National Identification Type</dt>
                <dd class="identifier-type badge-style">{{ $beneficiaryNationalIdentifier.NationalIdentifierType }}</dd>
              </div>
              <div class="transaction-preview-container">
                <dt class="font-semibold">Country of Issue</dt>
                <dd>{{ if $beneficiaryNationalIdentifier.CountryOfIssue }} {{ $beneficiaryNationalIdentifier.CountryOfIssue }} {{ else }} N/A {{ end }}</dd>
              </div>
              <div class="transaction-preview-container">
                <dt class="font-semibold">Registration Authority</dt>
                <dd>{{ if $beneficiaryNationalIdentifier.RegistrationAuthority }} {{ $beneficiaryNationalIdentifier.RegistrationAuthority }} {{ else }} N/A {{ end }}</dd>
              </div>
              <div class="transaction-preview-container">
                <dt class="font-semibold">Country of Registration</dt>
                <dd>{{ if $beneficiaryVasp.CountryOfRegistration }} {{ $beneficiaryVasp.CountryOfRegistration }} {{ else }} N/A {{ end }}</dd>
              </div>

            </dl>
          </div>
        </div>

      </section>
    </div>
  </div>
</div>